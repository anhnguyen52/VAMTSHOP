<app-header class="sticky top-0 z-50"></app-header>

<div class="grid grid-cols-5 gap-10 mx-20 my-10">
    <div *ngIf="isShowMenu" class="col-span-1 border-r-2 border-gray-300 " >
      <div class="sticky top-[120px] max-h-[calc(100vh-120px)] overflow-y-auto pr-2">
          <h1 class="text-[25px] font-bold " >What do you want?</h1>
          <div>
             <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">
              <!-- Node không có con -->
             <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>
                <li
                  class="mat-tree-node cursor-pointer li p-2"
                >
                  <span class="text-[16px] font-[400] span" (click)="filterProduct(node)"
                  [ngClass]="{ 'font-bold': node.name === selectedNodeName }">{{ node.name }}</span>
                </li>
              </mat-tree-node>

              <!-- Node có con -->
             <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
                <li class="list-none">
                  <div class="mat-tree-node p-2 cursor-pointer" matTreeNodeToggle>
                    <span class="text-[16px] font-[400] span" (click)="filterProduct(node)"
                          [ngClass]="{ 'font-bold': node.name === selectedNodeName }">{{ node.name }}</span>
                    <fa-icon 
                      [icon]="treeControl.isExpanded(node) ? faCaretUp : faCaretDown"
                      class="text-[30px] hover:text-gray-300 transition duration-500 mb-1 ml-3">
                    </fa-icon>
                  </div>

                  <ul [class.hidden]="!treeControl.isExpanded(node)" class="ml-5">
                    <ng-container matTreeNodeOutlet></ng-container>
                  </ul>
                </li>
              </mat-nested-tree-node>

            </mat-tree>
          </div>
      </div>
    </div>

    <div class="col-span-4" [ngClass]="{ 'col-span-5': !isShowMenu, 'col-span-4': isShowMenu }">
        <div class="flex flex-row justify-between">
            <h1 class="text-[25px] font-bold">Products</h1>
            <div class="flex flex-row gap-5">
                <button class="btn-style " (click)="toggleMenu()">{{statusMenu}}</button>
                <div class="relative">
                    <button class="btn-style" (click)="toggleSort()">Sort by</button>
                    <div class="absolute left-[-100px] top-[50px] bg-white shadow-lg rounded-lg mt-2 w-[200px] p-2 border-2  sort "
                      [ngClass]="{ 'hidden': !isShowSort } ">
                        <ul>
                          <li class="py-1 px-2 rounded-lg cursor-pointer hover:shadow-xl hover:scale-110 transition duration-300" (click)="applySort('new')" >New to Old</li>
                          <li class="py-1 px-2 rounded-lg cursor-pointer hover:shadow-xl hover:scale-110 transition duration-300" (click)="applySort('old')">Old to New</li>
                          <li class="py-1 px-2 rounded-lg cursor-pointer hover:shadow-xl hover:scale-110 transition duration-300" (click)="applySort('low')">Low to High Price</li>
                          <li class="py-1 px-2 rounded-lg cursor-pointer hover:shadow-xl hover:scale-110 transition duration-300" (click)="applySort('high')">High to Low Price</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="grid grid-cols-4 gap-10 my-10 text-center">
          <div *ngFor="let product of visibleProducts" 
                class="bg-white w-[350px] mx-auto p-4 flex flex-col min-h-[320px]
                transition duration-300 ease-in-out transform hover:scale-105  cursor-pointer " (click)="goToDetailProduct(product._id)">
              <div>
                <img src="{{product.image_urls[0]}}" alt="" class="w-full rounded-t-lg">
              </div>
              <div>
                <h1 class="text-[20px] font-bold text-gray-800 mt-2">{{product.product_name}}</h1>
              </div>
              <div class="mt-auto">
                <p class="text-gray-500 text-[14px]"> {{formatCurrency(product.price)}} vnđ</p>
              </div>
          </div>
        </div>

        <div class="flex justify-center mt-10">
          <button class="w-[100px] h-[40px] text-[14px] font-[500] bg-gray-800 text-white rounded-lg
                        hover:bg-white hover:text-black hover:border-gray-950 hover:border-[4px] hover:scale-105 transtion duration-100 "
                      *ngIf="visibleProducts.length < filteredProducts.length"  
                      (click)="loadMoreProducts()">
            Xem thêm
          </button>
        </div>
    </div>
</div>

<app-footer></app-footer>
